<html>
<head>
	<meta charset='utf-8'>
	<meta id="viewport" name="viewport" content ="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />	
	<title>Test</title>
	<script src="../contrib/modernizer.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Exo+2:200' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="../contrib/jquery-ui.css"></link>
	<script src="../contrib/jquery-1.9.1.js"></script>
	<script src="../contrib/jquery-ui.js"></script>
	<script src="../contrib/hammerjs/hammer.js"></script>
	<script src="../contrib/hammerjs/plugins/hammer.fakemultitouch.js"></script>
	<script src="../contrib/hammerjs/plugins/hammer.showtouches.js"></script>
	<style media="screen">

	.icons { display: none; }

	* {
	    -webkit-touch-callout:none;
	    -webkit-user-select:none;
	    -moz-user-select:none;
	    -ms-user-select:none;
	    user-select:none;
	}
	
	body {
		background-color: #fefefe;
		width: 100%;
		height: 100%;
		overflow: hidden;
		font-family: arial,verdana,sans-serif;
	}

	.drum-wrapper {
		position: relative;
		float: left;
		overflow: hidden;
		height: 145px;
		width:100px;
		border: 1px solid #CCC;
	}
	.container {
		width: 100%;
		height: 25px;
		position: absolute;
		top: 60px;
		left: 0px;
		-webkit-perspective: 1100px;
		-moz-perspective: 1100px;
		-o-perspective: 1100px;
		perspective: 1100px;
	}

	.drum {
		width: 100%;
		height: 100%;
		position: absolute;
		top: 0px;
		left: 0px;
		-webkit-transform-style: preserve-3d;
		-moz-transform-style: preserve-3d;
		-o-transform-style: preserve-3d;
		transform-style: preserve-3d;
	}

	.drum figure {
		-webkit-backface-visibility: hidden;
		-moz-backface-visibility: hidden;
		-o-backface-visibility: hidden;
		backface-visibility: hidden;
		display: block;
		position: absolute;
		height: 25px;
		left: 0px;
		top: 0px;
		line-height: 25px;
		color: black;
		margin: 0px;
		font-family: 'Exo 2', sans-serif;
		text-overflow: ellipsis;
		white-space: nowrap;
		overflow: hidden;
		width: 100px;
	}
	</style>
</head>
<body>
<select id="number" name="numbers"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option><option value="24">24</option><option value="25">25</option><option value="26">26</option><option value="27">27</option><option value="28">28</option><option value="29">29</option><option value="30">30</option><option value="31">31</option><option value="32">32</option><option value="33">33</option><option value="34">34</option><option value="35">35</option><option value="36">36</option><option value="37">37</option><option value="38">38</option>
<option value="39">39</option><option value="40">40</option><option value="41">41</option><option value="42">42</option><option value="43">43</option><option value="44">44</option><option value="45">45</option><option value="46">46</option><option value="47">47</option><option value="48">48</option><option value="49">49</option><option value="50">50</option><option value="51">51</option><option value="52">52</option><option value="53">53</option><option value="54">54</option><option value="55">55</option><option value="56">56</option><option value="57">57</option><option value="58">58</option><option value="59">59</option><option value="60">60</option><option value="61">61</option><option value="62">62</option><option value="63">63</option><option value="64">64</option><option value="65">65</option><option value="66">66</option><option value="67">67</option><option value="68">68</option><option value="69">69</option><option value="70">70</option><option value="71">71</option><option value="72">72</option><option value="73">73</option><option value="74">74</option><option value="75">75</option><option value="76">76</option><option value="77">77</option><option value="78">78</option><option value="79">79</option><option value="80">80</option><option value="81">81</option><option value="82">82</option><option value="83">83</option><option value="84">84</option><option value="85">85</option><option value="86">86</option><option value="87">87</option><option value="88">88</option><option value="89">89</option><option value="90">90</option><option value="91">91</option><option value="92">92</option><option value="93">93</option><option value="94">94</option><option value="95">95</option><option value="96">96</option><option value="97">97</option><option value="98">98</option><option value="99">99</option><option value="100">100</option><option value="101">101</option><option value="102">102</option><option value="103">103</option><option value="104">104</option><option value="105">105</option><option value="106">106</option><option value="107">107</option><option value="108">108</option><option value="109">109</option><option value="110">110</option><option value="111">111</option><option value="112">112</option><option value="113">113</option><option value="114">114</option><option value="115">115</option><option value="116">116</option><option value="117">117</option><option value="118">118</option><option value="119">119</option><option value="120">120</option><option value="121">121</option><option value="122">122</option><option value="123">123</option><option value="124">124</option><option value="125">125</option><option value="126">126</option><option value="127">127</option><option value="128">128</option><option value="129">129</option><option value="130">130</option><option value="131">131</option><option value="132">132</option><option value="133">133</option><option value="134">134</option><option value="135">135</option><option value="136">136</option><option value="137">137</option><option value="138">138</option><option value="139">139</option><option value="140">140</option><option value="141">141</option><option value="142">142</option><option value="143">143</option><option value="144">144</option><option value="145">145</option><option value="146">146</option><option value="147">147</option><option value="148">148</option><option value="149">149</option><option value="150">150</option><option value="151">151</option><option value="152">152</option><option value="153">153</option><option value="154">154</option><option value="155">155</option><option value="156">156</option><option value="157">157</option><option value="158">158</option><option value="159">159</option><option value="160">160</option><option value="161">161</option><option value="162">162</option><option value="163">163</option><option value="164">164</option><option value="165">165</option><option value="166">166</option><option value="167">167</option><option value="168">168</option><option value="169">169</option><option value="170">170</option><option value="171">171</option><option value="172">172</option><option value="173">173</option><option value="174">174</option><option value="175">175</option><option value="176">176</option><option value="177">177</option><option value="178">178</option><option value="179">179</option><option value="180">180</option><option value="181">181</option><option value="182">182</option><option value="183">183</option><option value="184">184</option><option value="185">185</option><option value="186">186</option><option value="187">187</option><option value="188">188</option><option value="189">189</option><option value="190">190</option><option value="191">191</option><option value="192">192</option><option value="193">193</option><option value="194">194</option><option value="195">195</option><option value="196">196</option><option value="197">197</option><option value="198">198</option><option value="199">199</option><option value="200">200</option><option value="201">201</option><option value="202">202</option><option value="203">203</option><option value="204">204</option><option value="205">205</option><option value="206">206</option><option value="207">207</option><option value="208">208</option><option value="209">209</option><option value="210">210</option><option value="211">211</option><option value="212">212</option><option value="213">213</option><option value="214">214</option><option value="215">215</option><option value="216">216</option><option value="217">217</option><option value="218">218</option><option value="219">219</option><option value="220">220</option><option value="221">221</option><option value="222">222</option><option value="223">223</option><option value="224">224</option><option value="225">225</option><option value="226">226</option><option value="227">227</option><option value="228">228</option><option value="229">229</option><option value="230">230</option><option value="231">231</option><option value="232">232</option><option value="233">233</option><option value="234">234</option><option value="235">235</option><option value="236">236</option><option value="237">237</option><option value="238">238</option><option value="239">239</option><option value="240">240</option><option value="241">241</option><option value="242">242</option><option value="243">243</option><option value="244">244</option><option value="245">245</option><option value="246">246</option><option value="247">247</option></select>
<select id="country" name="countries"><option value="GL">Greenland</option><option value="DJ">Djibouti</option><option value="JM">Jamaica</option><option value="AT">Austria</option><option value="PG">Papua New Guinea</option><option value="KI">Kiribati</option><option value="SZ">Swaziland</option><option value="YT">Mayotte</option><option value="BN">Brunei</option><option value="CD">Congo Democratic Republic</option><option value="ZM">Zambia</option><option value="AO">Angola</option><option value="BW">Botswana</option><option value="ZW">Zimbabwe</option><option value="VC">Saint Vincent and the Grenadines</option><option value="PR">Puerto Rico</option><option value="JP">Japan</option><option value="NA">Namibia</option><option value="SH">Saint Helena Ascension and Tristan da Cunha</option><option value="TJ">Tajikistan</option><option value="LC">Saint Lucia</option><option value="MA">Morocco</option><option value="VU">Vanuatu</option><option value="MT">Malta</option><option value="SV">El Salvador</option><option value="MN">Mongolia</option><option value="MP">Northern Mariana Islands</option><option value="IT">Italy</option><option value="RE">Réunion</option><option value="WS">Samoa</option><option value="CW">Curaçao</option><option value="FR">France</option><option value="EG">Egypt</option><option value="UZ">Uzbekistan</option><option value="PW">Palau</option><option value="LR">Liberia</option><option value="TK">Tokelau</option><option value="RW">Rwanda</option><option value="UM">United States Minor Outlying Islands</option><option value="TN">Tunisia</option><option value="BE">Belgium</option><option value="EE">Estonia</option><option value="CK">Cook Islands</option><option value="BY">Belarus</option><option value="LS">Lesotho</option><option value="KR">Korea South</option><option value="NO">Norway</option><option value="SA">Saudi Arabia</option><option value="ZA">South Africa</option><option value="PT">Portugal</option><option value="BF">Burkina Faso</option><option value="CA">Canada</option><option value="AM">Armenia</option><option value="CM">Cameroon</option><option value="SR">Suriname</option><option value="MG">Madagascar</option><option value="NP">Nepal</option><option value="BT">Bhutan</option><option value="PL">Poland</option><option value="CF">Central African Republic</option><option value="GA">Gabon</option><option value="TM">Turkmenistan</option><option value="AE">United Arab Emirates</option><option value="BA">Bosnia and Herzegovina</option><option value="TH">Thailand</option><option value="KY">Cayman Islands</option><option value="LA">Laos</option><option value="CC">Cocos Islands</option><option value="PH">Philippines</option><option value="NI">Nicaragua</option><option value="TF">French Southern Territories</option><option value="NC">New Caledonia</option><option value="GU">Guam</option><option value="KZ">Kazakhstan</option><option value="SJ">Svalbard</option><option value="MM">Myanmar</option><option value="NR">Nauru</option><option value="DM">Dominica</option><option value="NE">Niger</option><option value="AD">Andorra</option><option value="TO">Tonga</option><option value="MR">Mauritania</option><option value="SE">Sweden</option><option value="AZ">Azerbaijan</option><option value="AF">Afghanistan</option><option value="GS">South Georgia and the South Sandwich Islands</option><option value="NG">Nigeria</option><option value="KE">Kenya</option><option value="BJ">Benin</option><option value="ME">Montenegro</option><option value="AX">Åland Islands</option><option value="OM">Oman</option><option value="VG">British Virgin Islands</option><option value="VN">Vietnam</option><option value="DZ">Algeria</option><option value="YE">Yemen</option><option value="CI">Ivory Coast</option><option value="LK">Sri Lanka</option><option value="ID">Indonesia</option><option value="FM">Micronesia</option><option value="GE">Georgia</option><option value="GM">Gambia</option><option value="CX">Christmas Island</option><option value="LV">Latvia</option><option value="LB">Lebanon</option><option value="RU">Russia</option><option value="FK">Falkland Islands</option><option value="DE">Germany</option><option value="FI">Finland</option><option value="MV">Maldives</option><option value="LU">Luxembourg</option><option value="PN">Pitcairn</option><option value="VE">Venezuela</option><option value="BH">Bahrain</option><option value="GI">Gibraltar</option><option value="RO">Romania</option><option value="WF">Wallis and Futuna</option><option value="GP">Guadeloupe</option><option value="IN">India</option><option value="AR">Argentina</option><option value="VI">Virgin Islands</option><option value="TV">Tuvalu</option><option value="AW">Aruba</option><option value="SN">Senegal</option><option value="FO">Faroe Islands</option><option value="MX">Mexico</option><option value="MC">Monaco</option><option value="BR">Brazil</option><option value="HN">Honduras</option><option value="IL">Israel</option><option value="GG">Guernsey</option><option value="SB">Solomon Islands</option><option value="DO">Dominican Republic</option><option value="NZ">New Zealand</option><option value="HU">Hungary</option><option value="PS">Palestinian Territory</option><option value="SX">Sint Maarten</option><option value="UG">Uganda</option><option value="BQ">Bonaire, Sint Eustatius and Saba</option><option value="KH">Cambodia</option><option value="TG">Togo</option><option value="GB">United Kingdom</option><option value="BB">Barbados</option><option value="JE">Jersey</option><option value="HT">Haiti</option><option value="DK">Denmark</option><option value="PA">Panama</option><option value="QA">Qatar</option><option value="CV">Cape Verde</option><option value="GD">Grenada</option><option value="GF">French Guiana</option><option value="MO">Macao</option><option value="KM">Comoros</option><option value="MF">Saint Martin</option><option value="KW">Kuwait</option><option value="HR">Croatia</option><option value="MQ">Martinique</option><option value="TC">Turks and Caicos Islands</option><option value="CZ">Czech Republic</option><option value="MZ">Mozambique</option><option value="BL">Saint Barthelemy</option><option value="ES">Spain</option><option value="BO">Bolivia</option><option value="AU">Australia</option><option value="ST">Sao Tome and Principe</option><option value="AL">Albania</option><option value="IR">Iran</option><option value="CG">Congo Republic</option><option value="TR">Turkey</option><option value="MD">Moldova</option><option value="GW">Guinea-Bissau</option><option value="BI">Burundi</option><option value="GN">Guinea</option><option value="MK">Macedonia</option><option value="GR">Greece</option><option value="AG">Antigua and Barbuda</option><option value="SI">Slovenia</option><option value="CO">Colombia</option><option value="AI">Anguilla</option><option value="AQ">Antarctica</option><option value="JO">Jordan</option><option value="SM">San Marino</option><option value="UA">Ukraine</option><option value="CU">Cuba</option><option value="CL">Chile</option><option value="EH">Western Sahara</option><option value="KN">Saint Kitts and Nevis</option><option value="ML">Mali</option><option value="SC">Seychelles</option><option value="ET">Ethiopia</option><option value="IS">Iceland</option><option value="MS">Montserrat</option><option value="NL">Netherlands</option><option value="HK">Hong Kong</option><option value="EC">Ecuador</option><option value="MY">Malaysia</option><option value="CR">Costa Rica</option><option value="VA">Holy See</option><option value="IO">British Indian Ocean Territory</option><option value="SD">Sudan</option><option value="RS">Serbia</option><option value="CN">China</option><option value="BG">Bulgaria</option><option value="MH">Marshall Islands</option><option value="UY">Uruguay</option><option value="PY">Paraguay</option><option value="BS">Bahamas</option><option value="TL">Timor-Leste</option><option value="MU">Mauritius</option><option value="LI">Liechtenstein</option><option value="CH">Switzerland</option><option value="KG">Kyrgyzstan</option><option value="GH">Ghana</option><option value="NU">Niue</option><option value="US">United States</option><option value="PE">Peru</option><option value="SL">Sierra Leone</option><option value="BZ">Belize</option><option value="CY">Cyprus</option><option value="IM">Isle of Man</option><option value="FJ">Fiji</option><option value="IE">Ireland</option><option value="TW">Taiwan</option><option value="KP">Korea North</option><option value="PF">French Polynesia</option><option value="ER">Eritrea</option><option value="IQ">Iraq</option><option value="AS">American Samoa</option><option value="TZ">Tanzania</option><option value="MW">Malawi</option><option value="LY">Libya</option><option value="GT">Guatemala</option><option value="GY">Guyana</option><option value="BM">Bermuda</option><option value="GQ">Equatorial Guinea</option><option value="PK">Pakistan</option><option value="BV">Bouvet Island</option><option value="LT">Lithuania</option><option value="SG">Singapore</option><option value="PM">Saint Pierre and Miquelon</option><option value="TT">Trinidad and Tobago</option><option value="NF">Norfolk Island</option><option value="TD">Chad</option><option value="SO">Somalia</option><option value="SK">Slovakia</option><option value="SY">Syria</option><option value="HM">Heard Island and McDonald Islands</option><option value="BD">Bangladesh</option></select>
<select id="n45" name="numbers"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option><option value="24">24</option><option value="25">25</option><option value="26">26</option><option value="27">27</option><option value="28">28</option><option value="29">29</option><option value="30">30</option><option value="31">31</option><option value="32">32</option><option value="33">33</option><option value="34">34</option><option value="35">35</option><option value="36">36</option><option value="37">37</option><option value="38">38</option>
<option value="39">39</option><option value="40">40</option><option value="41">41</option><option value="42">42</option><option value="43">43</option><option value="44">44</option><option value="45">45</option></select>
<script>
	"use strict";

	Hammer.plugins.fakeMultitouch();
	Hammer.plugins.showTouches();

	function DrumModel (data, i) {
		this.data = data;
		this.index = i;
	}
	DrumModel.prototype.getText = function () {
		return this.data[this.index].text;
	}	
	DrumModel.prototype.getValue = function () {
		return this.data[this.index].value;
	}

	function PanelModel (index, dataModel, parent) {
		this.angle = parent.theta * index;
		this.index = index;
		this.dataModel = dataModel;
		this.elem = document.createElement('figure');

		$(this.elem).addClass('a' + this.angle);
		$(this.elem).css('opacity', '0.5');
		$(this.elem).css(parent.transformProp, parent.rotateFn + '(' + -this.angle + 'deg) translateZ(' + parent.radius + 'px)');
		$(parent.element).append(this.elem);
		this.setText();
	}
	PanelModel.prototype.setText = function () {
		$(this.elem).text(this.dataModel.getText());
	}
	PanelModel.prototype.update = function (data_index) {
		if (this.dataModel.index != data_index) {
			this.dataModel.index = data_index;
			this.setText();
		}
	}

	function Drum ( el, data ) {
		this.element = el;
		this.data = data;

		this.panelCount = 24;
		this.rotateFn = 'rotateX';
		this.transformProp = Modernizr.prefixed('transform');
		
		this.rotation = 0;
		this.distance = 0;
		this.last_angle = 0;
		
		this.theta = 360 / this.panelCount;
		this.radius = Math.round( ( this.element['offsetHeight'] / 2 ) / Math.tan( Math.PI / this.panelCount ) );
console.log(this.element);
		this.mapping = [];

		this.setup();
		this.attachevents();
	};
	Drum.prototype.setup = function() {
		var c = 0;
		for (var i=0; i < this.panelCount; i++) {
			var j = c;
			if (c >= (this.panelCount / 2)) {
				j = this.data.length - (this.panelCount - c);
			}
			c++;
			this.mapping.push(new PanelModel(i, new DrumModel(this.data, j), this));
		}
		this.transform();
	};
	Drum.prototype.attachevents = function () {
		var hammertime = Hammer(this.element.parentNode.parentNode, {
			prevent_default: true,
			no_mouseevents: true
		});
		
		hammertime.on("dragstart", (function (e) { 
			this.distance = 0;
		}).bind(this) );

		hammertime.on("drag", (function (e) {
			var evt = ["up", "down"];
			if (evt.indexOf(e.gesture.direction)>=0) {
				this.deltaRotate(Math.round(e.gesture.deltaY - this.distance) * -1);
				this.distance = e.gesture.deltaY;
			}
		}).bind(this) );

		hammertime.on("dragend", (function (e) {
			this.nearestRotate();

	    	var selected = this.getSelected().dataModel;
			console.log(selected.getValue() + ":" + selected.getText());

		}).bind(this) );
	};
	Drum.prototype.update = function (selected) {
		var c, list = [], pc = this.panelCount, ph = this.panelCount / 2;
		var i = selected.index; 
		var j = selected.dataModel.index;
		for (var k=j-ph; k<=j+ph-1; k++) {
			c = k;
			if (k < 0)
				c = this.data.length+k;
			if (k > this.data.length-1)
				c = k-this.data.length;
			list.push(c);
		}
		var t = list.slice(ph-i); 
		list = t.concat(list.slice(0, pc - t.length));
		for (var i=0; i<this.mapping.length; i++) {
			this.mapping[i].update(list[i]);
		}
	};
    Drum.prototype.transform = function() {
    	var selected = this.getSelected();
		$(this.element).css(this.transformProp, 'translateZ(-' + this.radius + 'px) ' + this.rotateFn + '(' + this.rotation + 'deg)');
		$(selected.elem).css("opacity", 1);
		$("figure:not(.a" + selected.angle + ", .hidden)", this.element).css("opacity", "0.5");

    	if (selected.angle != this.last_angle && [0,90,180,270].indexOf(selected.angle) >= 0) {
			this.last_angle = selected.angle;
			this.update(selected);
    	}
    };
    Drum.prototype.getNearest = function (deg) {
    	deg = deg || this.rotation;
   		var th = (this.theta / 2);
   		var n = 360;
		var angle = ((deg + th) % n + n) % n;
		angle = angle - angle % this.theta;
		return angle;
    };
    Drum.prototype.getSelected = function () {
		var nearest = this.getNearest();    	
		for (var i in this.mapping) {
			if (this.mapping[i].angle == nearest) {
				return this.mapping[i];
				break;
			}
		}
    };
    Drum.prototype.setRotation = function(deg) {
		this.rotation = deg;
	};
    Drum.prototype.getRotation = function() {
		return this.rotation;
	};
	Drum.prototype.deltaRotate = function(delta) {
		var rotation = this.getRotation();
		this.setRotation(this.rotation + delta);
		this.transform();
	};
	Drum.prototype.nearestRotate= function() {
		this.setRotation(this.getNearest());
		this.transform();
	};

	$(function() {
		$.widget( "drumjs.drum", {
		    _create: function() {
		    	$(this.element).hide();
		    	var my = this.element[0];
		    	my.data = [];

		    	for (var i=0; i<my.children.length; i++) {
		    		my.data.push({ value: $(my.children[i]).attr('value'), text: $(my.children[i]).text() })
		    	}

		    	var wrapper = document.createElement( "div" );
				$(wrapper).addClass("drum-wrapper");
				$(this.element).after(wrapper);

		        var container = document.createElement( "div" );
				$(container).addClass("container");

				var drum = document.createElement( "div" );
				$(drum).addClass("drum");
				$(drum).appendTo(container);

				$(container).appendTo(wrapper);

				my.drum = new Drum(drum, my.data);
		    }
		});

		$("#country").drum();
		$("#number").drum();
		$("#n45").drum();
	});
	</script>
</body>
</html>